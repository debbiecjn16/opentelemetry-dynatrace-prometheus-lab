# Based on Dynatrace Official Multi-Export Example
# https://docs.dynatrace.com/docs/ingest-from/opentelemetry/collector/use-cases/multi-export

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch:
    timeout: 10s
    send_batch_size: 1024

exporters:
  # Dynatrace exporter (as per official docs)
  otlphttp/dynatrace:
    endpoint: ${env:DT_ENDPOINT}
    headers:
      Authorization: "Api-Token ${env:DT_API_TOKEN}"

  # Prometheus exporter (our addition for multi-backend)
  prometheus:
    endpoint: "0.0.0.0:8889"
    namespace: app

  # Debug exporter (optional, for troubleshooting)
  debug:
    verbosity: normal

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlphttp/dynatrace, debug]

    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlphttp/dynatrace, prometheus, debug]

    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlphttp/dynatrace, debug]

  extensions: [health_check]

extensions:
  health_check:
    endpoint: 0.0.0.0:13133
